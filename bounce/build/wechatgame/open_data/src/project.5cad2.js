window.__require=function e(t,a,n){function o(r,c){if(!a[r]){if(!t[r]){var s=r.split("/");if(s=s[s.length-1],!t[s]){var l="function"==typeof __require&&__require;if(!c&&l)return l(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+r+"'")}}var g=a[r]={exports:{}};t[r][0].call(g.exports,function(e){return o(t[r][1][e]||e)},g,g.exports,e,t,a,n)}return a[r].exports}for(var i="function"==typeof __require&&__require,r=0;r<n.length;r++)o(n[r]);return o}({GameOverRank:[function(e,t,a){"use strict";cc._RF.push(t,"d97bdIn/jtJmpn7qz0kKhI5","GameOverRank"),cc.Class({extends:cc.Component,name:"GameOverRank",properties:{backSprite:cc.Node,rankLabel:cc.Label,avatarImgSprite:cc.Sprite,nickLabel:cc.Label,topScoreLabel:cc.Label},start:function(){},init:function(e,t,a){var n=t.avatarUrl,o=t.nickname,i=0!=t.KVDataList.length?t.KVDataList[0].value:0;e%2==0&&(this.backSprite.color=new cc.Color(55,55,55,255)),a&&(this.rankLabel.node.color=new cc.Color(0,255,0,255)),this.rankLabel.string=(e+1).toString(),this.createImage(n),this.nickLabel.string=o,this.topScoreLabel.string=i.toString()},createImage:function(e){var t=this;cc.loader.load({url:e,type:"jpg"},function(e,a){t.avatarImgSprite.spriteFrame=new cc.SpriteFrame(a)})}}),cc._RF.pop()},{}],GameRankingList:[function(e,t,a){"use strict";cc._RF.push(t,"a0ea2Faum1JDKkSr0Ka631L","GameRankingList"),cc.Class({extends:cc.Component,properties:{rankingScrollView:cc.ScrollView,scrollViewContent:cc.Node,prefabRankItem:cc.Prefab,prefabGameOverRank:cc.Prefab,gameOverRankLayout:cc.Node,loadingLabel:cc.Node},start:function(){var e=this;this.removeChild(),this.CC_WECHATGAME=!0,this.CC_WECHATGAME?window.wx.onMessage(function(t){console.log("\u63a5\u6536\u4e3b\u57df\u53d1\u6765\u6d88\u606f\uff1a",t),0==t.messageType?e.removeChild():1==t.messageType?e.fetchFriendData(t.MAIN_MENU_NUM):3==t.messageType?e.submitScore(t.MAIN_MENU_NUM,t.score):4==t.messageType?e.gameOverRank(t.MAIN_MENU_NUM):5==t.messageType&&e.fetchGroupFriendData(t.MAIN_MENU_NUM,t.shareTicket)}):this.fetchFriendData(1e3)},submitScore:function(e,t){this.CC_WECHATGAME?window.wx.getUserCloudStorage({keyList:[e],success:function(a){console.log("getUserCloudStorage","success",a),0!=a.KVDataList.length&&a.KVDataList[0].value>t||window.wx.setUserCloudStorage({KVDataList:[{key:e,value:""+t}],success:function(e){console.log("setUserCloudStorage","success",e)},fail:function(e){console.log("setUserCloudStorage","fail")},complete:function(e){console.log("setUserCloudStorage","ok")}})},fail:function(e){console.log("getUserCloudStorage","fail")},complete:function(e){console.log("getUserCloudStorage","ok")}}):cc.log("\u63d0\u4ea4\u5f97\u5206:"+e+" : "+t)},removeChild:function(){null!=this.node.getChildByName("1000")&&this.node.removeChild(this.node.getChildByName("1000")),this.rankingScrollView.node.active=!1,this.scrollViewContent.removeAllChildren(),this.gameOverRankLayout.active=!1,this.gameOverRankLayout.removeAllChildren(),this.loadingLabel.getComponent(cc.Label).string="\u73a9\u547d\u52a0\u8f7d\u4e2d...",this.loadingLabel.active=!0},fetchFriendData:function(e){var t=this;this.removeChild(),this.rankingScrollView.node.active=!0,this.CC_WECHATGAME&&wx.getUserInfo({openIdList:["selfOpenId"],success:function(a){t.loadingLabel.active=!1,console.log("success",a.data);var n=a.data[0];wx.getFriendCloudStorage({keyList:[e],success:function(e){console.log("wx.getFriendCloudStorage success",e);var a=e.data;a.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value});for(var o=0;o<a.length;o++){var i=a[o],r=cc.instantiate(t.prefabRankItem);if(r.getComponent("RankItem").init(o,i),t.scrollViewContent.addChild(r),a[o].avatarUrl==n.avatarUrl){var c=cc.instantiate(t.prefabRankItem);c.getComponent("RankItem").init(o,i),c.y=-354,t.node.addChild(c,1,"1000")}}a.length<=8&&(t.scrollViewContent.getComponent(cc.Layout).resizeMode=cc.Layout.ResizeMode.NONE)},fail:function(e){console.log("wx.getFriendCloudStorage fail",e),t.loadingLabel.getComponent(cc.Label).string="\u6570\u636e\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u68c0\u6d4b\u7f51\u7edc\uff0c\u8c22\u8c22\u3002"}})},fail:function(e){t.loadingLabel.getComponent(cc.Label).string="\u6570\u636e\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u68c0\u6d4b\u7f51\u7edc\uff0c\u8c22\u8c22\u3002"}})},fetchGroupFriendData:function(e,t){var a=this;this.removeChild(),this.rankingScrollView.node.active=!0,this.CC_WECHATGAME&&wx.getUserInfo({openIdList:["selfOpenId"],success:function(n){console.log("success",n.data);var o=n.data[0];wx.getGroupCloudStorage({shareTicket:t,keyList:[e],success:function(e){console.log("wx.getGroupCloudStorage success",e),a.loadingLabel.active=!1;var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value});for(var n=0;n<t.length;n++){var i=t[n],r=cc.instantiate(a.prefabRankItem);if(r.getComponent("RankItem").init(n,i),a.scrollViewContent.addChild(r),t[n].avatarUrl==o.avatarUrl){var c=cc.instantiate(a.prefabRankItem);c.getComponent("RankItem").init(n,i),c.y=-354,a.node.addChild(c,1,"1000")}}t.length<=8&&(a.scrollViewContent.getComponent(cc.Layout).resizeMode=cc.Layout.ResizeMode.NONE)},fail:function(e){console.log("wx.getFriendCloudStorage fail",e),a.loadingLabel.getComponent(cc.Label).string="\u6570\u636e\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u68c0\u6d4b\u7f51\u7edc\uff0c\u8c22\u8c22\u3002"}})},fail:function(e){a.loadingLabel.getComponent(cc.Label).string="\u6570\u636e\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u68c0\u6d4b\u7f51\u7edc\uff0c\u8c22\u8c22\u3002"}})},gameOverRank:function(e){var t=this;this.removeChild(),this.gameOverRankLayout.active=!0,this.CC_WECHATGAME&&wx.getUserInfo({openIdList:["selfOpenId"],success:function(a){console.log("success",a.data);var n=a.data[0];wx.getFriendCloudStorage({keyList:[e],success:function(e){console.log("wx.getFriendCloudStorage success",e),t.loadingLabel.active=!1;var a=e.data;a.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value});for(var o=0;o<a.length;o++)if(a[o].avatarUrl==n.avatarUrl){if(o-1>=0){if(o+1>=a.length&&o-2>=0){var i=cc.instantiate(t.prefabGameOverRank);i.getComponent("GameOverRank").init(o-2,a[o-2]),t.gameOverRankLayout.addChild(i)}var r=cc.instantiate(t.prefabGameOverRank);r.getComponent("GameOverRank").init(o-1,a[o-1]),t.gameOverRankLayout.addChild(r)}else if(o+2>=a.length){var c=new cc.Node;c.width=200,t.gameOverRankLayout.addChild(c)}var s=cc.instantiate(t.prefabGameOverRank);if(s.getComponent("GameOverRank").init(o,a[o],!0),t.gameOverRankLayout.addChild(s),o+1<a.length){var l=cc.instantiate(t.prefabGameOverRank);if(l.getComponent("GameOverRank").init(o+1,a[o+1]),t.gameOverRankLayout.addChild(l),o-1<0&&o+2<a.length){var g=cc.instantiate(t.prefabGameOverRank);g.getComponent("GameOverRank").init(o+2,a[o+2]),t.gameOverRankLayout.addChild(g)}}}},fail:function(e){console.log("wx.getFriendCloudStorage fail",e),t.loadingLabel.getComponent(cc.Label).string="\u6570\u636e\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u68c0\u6d4b\u7f51\u7edc\uff0c\u8c22\u8c22\u3002"}})},fail:function(e){t.loadingLabel.getComponent(cc.Label).string="\u6570\u636e\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u68c0\u6d4b\u7f51\u7edc\uff0c\u8c22\u8c22\u3002"}})}}),cc._RF.pop()},{}],RankItem:[function(e,t,a){"use strict";cc._RF.push(t,"dd553fmL+BGfJ9idSJ4ApIP","RankItem"),cc.Class({extends:cc.Component,name:"RankItem",properties:{backSprite:cc.Node,rankLabel:cc.Label,avatarImgSprite:cc.Sprite,nickLabel:cc.Label,topScoreLabel:cc.Label},start:function(){},init:function(e,t){var a=t.avatarUrl,n=t.nickname,o=0!=t.KVDataList.length?t.KVDataList[0].value:0;e%2==0&&(this.backSprite.color=new cc.Color(55,55,55,255)),0==e?(this.rankLabel.node.color=new cc.Color(255,0,0,255),this.rankLabel.node.setScale(2)):1==e?(this.rankLabel.node.color=new cc.Color(255,255,0,255),this.rankLabel.node.setScale(1.6)):2==e&&(this.rankLabel.node.color=new cc.Color(100,255,0,255),this.rankLabel.node.setScale(1.3)),this.rankLabel.string=(e+1).toString(),this.createImage(a),this.nickLabel.string=n,this.topScoreLabel.string=o.toString()},createImage:function(e){var t=this;cc.loader.load({url:e,type:"jpg"},function(e,a){t.avatarImgSprite.spriteFrame=new cc.SpriteFrame(a)})}}),cc._RF.pop()},{}]},{},["GameOverRank","GameRankingList","RankItem"]);